<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/libs/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" href="/static/libs/web-icons/web-icons.css">
    <link rel="stylesheet" href="/static/libs/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="/static/libs/bootstrap-table-master/bootstrap-table.css">
    <link rel="stylesheet" href="/static/libs/toastr/css/toastr.css">
    <link rel="stylesheet" href="/static/libs/bootstrap-validator/css/bootstrapValidator.css">
    <title>Document</title>
</head>

<body>
    <div style="padding: 50px;">
        <p>
            <button class="btn btn-primary" id="add-user-button">
                <i class="glyphicon glyphicon-plus"></i>
                <span>添加</span>
            </button>
            <button class="btn btn-primary" id="delete-user-button">
                <i class="glyphicon glyphicon-minus"></i>
                <span>删除</span>
            </button>
        </p>
        <table id="user-table" data-toggle="table" class="table table-striped table-bordered"></table>
    </div>

    <!-- // 添加用户 madal begin -->
    <div class="modal fade" id="add-user-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-create">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        ×
                    </button>
                    <h4 class="modal-title">添加用户 </h4>
                </div>
                <form id="add-user-modal-form" method="post" class="form-horizontal" action="">
                    <div class="modal-body">
                        <!-- // modal-body begin -->

                        <div class="form-group">
                            <label class="col-lg-4 col-md-4 col-sm-4 control-label font-normal"
                                style="text-align: right;">姓名：</label>
                            <div class="col-lg-5 col-md-5 col-sm-5">
                                <input type="text" class="form-control" id="add-user-modal-name" name="addUserModalName"
                                    maxlength="32" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-lg-4 col-md-4 col-sm-4 control-label font-normal"
                                style="text-align: right;">年龄：</label>
                            <div class="col-lg-5 col-md-5 col-sm-5">
                                <select id="add-user-modal-age" name="addUserModalAge" class="form-control">
                                    <option value="18">18</option>
                                    <option value="19">19</option>
                                    <option value="20">20</option>
                                    <option value="21">21</option>
                                    <option value="22">22</option>
                                    <option value="23">23</option>
                                    <option value="24">24</option>
                                    <option value="25">25</option>
                                    <option value="26">26</option>
                                    <option value="27">27</option>
                                    <option value="28">28</option>
                                    <option value="29">29</option>
                                    <option value="30">30</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-lg-4 col-md-4 col-sm-4 control-label font-normal"
                                style="text-align: right;">性别：</label>
                            <div class="col-lg-5 col-md-5 col-sm-5">
                                <select id="add-user-modal-sex" name="addUserModalSex" class="form-control">
                                    <option value="男">男</option>
                                    <option value="女">女</option>
                                    <option value="未知">未知</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-lg-4 col-md-4 col-sm-4 control-label font-normal"
                                style="text-align: right;">城市：</label>
                            <div class="col-lg-5 col-md-5 col-sm-5">
                                <select id="add-user-modal-city" name="addUserModalCity" class="form-control">
                                    <option value="北京">北京</option>
                                    <option value="上海">上海</option>
                                    <option value="广州">广州</option>
                                    <option value="深圳">深圳</option>
                                    <option value="成都">成都</option>
                                    <option value="南京">南京</option>
                                    <option value="杭州">杭州</option>
                                    <option value="杭州">杭州</option>
                                    <option value="天津">天津</option>
                                    <option value="武汉">武汉</option>
                                    <option value="长沙">长沙</option>
                                    <option value="郑州">郑州</option>
                                    <option value="合肥">合肥</option>
                                    <option value="石家庄">石家庄</option>
                                    <option value="沈阳">沈阳</option>
                                    <option value="西安">西安</option>
                                    <option value="济南">济南</option>
                                    <option value="福州">福州</option>
                                </select>
                            </div>
                        </div>

                        <!-- // modal-body end -->
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-success" type="submit">
                            确 定
                        </button>
                        <button class="btn btn-default" type="button" data-dismiss="modal">
                            取 消
                        </button>
                    </div>
                </form>
            </div><!-- /Modal -->
        </div>
    </div><!-- // 添加用户 madal end -->

    <!-- // 编辑用户 madal begin -->
    <div class="modal fade" id="edit-user-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-create">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        ×
                    </button>
                    <h4 class="modal-title">编辑用户 </h4>
                </div>
                <form id="edit-user-modal-form" method="post" class="form-horizontal" action="">
                    <div class="modal-body">
                        <!-- // modal-body begin -->
                        <input type="hidden" id="edit-user-modal-id" value="" />

                        <div class="form-group">
                            <label class="col-lg-4 col-md-4 col-sm-4 control-label font-normal"
                                style="text-align: right;">姓名：</label>
                            <div class="col-lg-5 col-md-5 col-sm-5">
                                <input type="text" class="form-control" id="edit-user-modal-name"
                                    name="editUserModalName" maxlength="32" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-lg-4 col-md-4 col-sm-4 control-label font-normal"
                                style="text-align: right;">年龄：</label>
                            <div class="col-lg-5 col-md-5 col-sm-5">
                                <select id="edit-user-modal-age" name="editUserModalAge" class="form-control">
                                    <option value="18">18</option>
                                    <option value="19">19</option>
                                    <option value="20">20</option>
                                    <option value="21">21</option>
                                    <option value="22">22</option>
                                    <option value="23">23</option>
                                    <option value="24">24</option>
                                    <option value="25">25</option>
                                    <option value="26">26</option>
                                    <option value="27">27</option>
                                    <option value="28">28</option>
                                    <option value="29">29</option>
                                    <option value="30">30</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-lg-4 col-md-4 col-sm-4 control-label font-normal"
                                style="text-align: right;">性别：</label>
                            <div class="col-lg-5 col-md-5 col-sm-5">
                                <select id="edit-user-modal-sex" name="editUserModalSex" class="form-control">
                                    <option value="男">男</option>
                                    <option value="女">女</option>
                                    <option value="未知">未知</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-lg-4 col-md-4 col-sm-4 control-label font-normal"
                                style="text-align: right;">城市：</label>
                            <div class="col-lg-5 col-md-5 col-sm-5">
                                <select id="edit-user-modal-city" name="editUserModalCity" class="form-control">
                                    <option value="北京">北京</option>
                                    <option value="上海">上海</option>
                                    <option value="广州">广州</option>
                                    <option value="深圳">深圳</option>
                                    <option value="成都">成都</option>
                                    <option value="南京">南京</option>
                                    <option value="杭州">杭州</option>
                                    <option value="杭州">杭州</option>
                                    <option value="天津">天津</option>
                                    <option value="武汉">武汉</option>
                                    <option value="长沙">长沙</option>
                                    <option value="郑州">郑州</option>
                                    <option value="合肥">合肥</option>
                                    <option value="石家庄">石家庄</option>
                                    <option value="沈阳">沈阳</option>
                                    <option value="西安">西安</option>
                                    <option value="济南">济南</option>
                                    <option value="福州">福州</option>
                                </select>
                            </div>
                        </div>

                        <!-- // modal-body end -->
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-success" type="submit">
                            确 定
                        </button>
                        <button class="btn btn-default" type="button" data-dismiss="modal">
                            取 消
                        </button>
                    </div>
                </form>
            </div><!-- /Modal -->
        </div>
    </div><!-- // 编辑用户 madal end -->

    <script src="/static/libs/jquery/jquery-1.11.2.min.js"></script>
    <script src="/static/libs/bootstrap/js/bootstrap.js"></script>
    <script src="/static/libs/toastr/js/toastr.min.js"></script>
    <script src="/static/libs/bootstrap-table-master/bootstrap-table.js"></script>
    <script src="/static/libs/bootstrap-table-master/locale/bootstrap-table-zh-CN.js"></script>
    <script src="/static/libs/bootstrap-validator/js/bootstrapValidator.js"></script>
    <script>
        var $userTable = $('#user-table').bootstrapTable('destroy').bootstrapTable({
            url: '/list',
            method: 'GET',
            dataType: "json",
            uniqueId: 'id',
            striped: false,
            cache: false,
            sortName: 'id',
            sortable: true,
            sortOrder: 'desc',
            sidePagination: "server",
            undefinedText: '--',
            singleSelect: false,
            //showRefresh   : true,
            //showColumns   : true,
            toolbar: '#user-table-toolbar',
            search: false,
            strictSearch: true,
            clickToSelect: true,
            pagination: true,
            pageNumber: 1,
            pageSize: 10,
            pageList: [5, 10, 20, 50, 100],
            paginationPreText: "上一页",
            paginationNextText: "下一页",
            //showToggle: true,
            //cardView: false,
            //detailView: false,
            //showPaginationSwitch: true,
            queryParamsType: "",
            queryParams: function (params) {
                var temp = {
                    'pageSize': params.pageSize,
                    'pageNumber': params.pageNumber,
                    'sortName': params.sortName,
                    'sortOrder': params.sortOrder
                };
                return temp;
            },
            columns: [
                {
                    checkbox: true
                },
                {
                    field: 'name',
                    title: '姓名',
                    width: '20%'
                }, {
                    field: 'age',
                    title: '年龄'
                }, {
                    field: 'gender',
                    title: '性别'
                }, {
                    field: 'city',
                    title: '城市'
                }, {
                    title: '编辑',
                    formatter: function (value, row, index) {
                        return `<button class="btn btn-action" type="button" title="编辑" onclick="editUser(${row.id}, '${row.name}', '${row.age}', '${row.gender}', '${row.city}')" style="background: none;">
                            <i class="fa fa-edit" id="iconedit"></i>
                            </button>`
                    }
                }
            ],
            onLoadSuccess: function () {
                //toastr.success('表格加载成功', '成功提示');
            },
            onLoadError: function () {
                //showTips("数据加载失败！");
            },
            onClickRow: function (row, $element) {
                var id = row.ID;
                //EditViewById(id, 'view');
                console.log(row);
            }
        });

        $("#add-user-button").click(function () {
            $("#add-user-modal").modal({
                show: true,
                backdrop: 'static'
            })
        })

        $('#add-user-modal-form').bootstrapValidator({
            message: 'This value is not valid',
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            excluded: [":disabled"],
            fields: {
                addUserModalName: {
                    message: '姓名无效',
                    validators: {
                        notEmpty: {
                            message: '姓名不能为空'
                        }
                    }
                },
                addUserModalAge: {
                    message: '年龄无效',
                    validators: {
                        notEmpty: {
                            message: '年龄不能为空'
                        }
                    }
                },
                addUserModalSex: {
                    message: '性别无效',
                    validators: {
                        notEmpty: {
                            message: '性别不能为空'
                        }
                    }
                },
                addUserModalCity: {
                    message: '城市无效',
                    validators: {
                        notEmpty: {
                            message: '城市不能为空'
                        }
                    }
                }
            }
        }).on('success.form.bv', function (e) {
            e.preventDefault();

            var params = {
                name: $("#add-user-modal-name").val(),
                age: $("#add-user-modal-age").val(),
                gender: $("#add-user-modal-sex").val(),
                city: $("#add-user-modal-city").val()
            }

            $.ajax({
                type: "POST",
                url: '/add',
                data: params,
                dataType: "json",
                timeout: 60 * 1000,
                //contentType: 'application/json',
                success: function (data) {
                    if (data.ret) {
                        $('#add-user-modal-form')[0].reset();
                        $('#add-user-modal-form').data('bootstrapValidator').resetForm();
                        $("#add-user-modal").modal("hide");
                        toastr.success("创建用户成功！", "成功提示");
                        $userTable.bootstrapTable("refresh");
                    } else {
                        toastr.error(data.msg, "错误提示");
                    }
                },
                error: function (data) {
                    toastr.error("操作失败！", "错误提示");
                }
            });
        });

        $("#delete-user-button").click(function () {
            var checkedUserArr = $userTable.bootstrapTable('getSelections');
            var len = checkedUserArr.length;

            if (len === 0) {
                toastr.error("请选择要删除的用户！", "错误提示");
            } else {
                var userIdArr = [];

                for (var i = 0; i < len; i++) {
                    userIdArr.push(checkedUserArr[i].id);
                }

                var params = {
                    "userIdArr": JSON.stringify(userIdArr)
                }

                $.ajax({
                    type: "DELETE",
                    url: '/delete',
                    data: params,
                    dataType: "json",
                    timeout: 60 * 1000,
                    //contentType: 'application/json',
                    success: function (data) {
                        if (data.ret) {
                            toastr.success("删除成功！", "正确提示");
                            $userTable.bootstrapTable("refresh");
                        } else {
                            toastr.error(data.msg, "错误提示");
                        }
                    },
                    error: function (data) {
                        toastr.error("网络错误，操作失败！", "错误提示");
                    }
                });
            }
        })

        // 编辑
        function editUser(id, name, age, gender, city) {
            $("#edit-user-modal").modal({
                show: true,
                backdrop: 'static'
            })

            $("#edit-user-modal-id").val(id);
            $("#edit-user-modal-name").val(name);
            $("#edit-user-modal-age").val(age);
            $("#edit-user-modal-sex").val(gender);
            $("#edit-user-modal-city").val(city);
        }

        $('#edit-user-modal-form').bootstrapValidator({
            message: 'This value is not valid',
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            excluded: [":disabled"],
            fields: {
                editUserModalName: {
                    message: '姓名无效',
                    validators: {
                        notEmpty: {
                            message: '姓名不能为空'
                        }
                    }
                },
                editUserModalAge: {
                    message: '年龄无效',
                    validators: {
                        notEmpty: {
                            message: '年龄不能为空'
                        }
                    }
                },
                editUserModalSex: {
                    message: '性别无效',
                    validators: {
                        notEmpty: {
                            message: '性别不能为空'
                        }
                    }
                },
                editUserModalCity: {
                    message: '城市无效',
                    validators: {
                        notEmpty: {
                            message: '城市不能为空'
                        }
                    }
                }
            }
        }).on('success.form.bv', function (e) {
            e.preventDefault();

            console.log($("#edit-user-modal-id").val());

            var params = {
                id: $("#edit-user-modal-id").val(),
                name: $("#edit-user-modal-name").val(),
                age: $("#edit-user-modal-age").val(),
                gender: $("#edit-user-modal-sex").val(),
                city: $("#edit-user-modal-city").val()
            }

            $.ajax({
                type: "POST",
                url: '/edit',
                data: params,
                dataType: "json",
                timeout: 60 * 1000,
                //contentType: 'application/json',
                success: function (data) {
                    if (data.ret) {
                        $('#edit-user-modal-form')[0].reset();
                        $('#edit-user-modal-form').data('bootstrapValidator').resetForm();
                        $("#edit-user-modal").modal("hide");
                        toastr.success("编辑用户成功！", "成功提示");
                        $userTable.bootstrapTable("refresh");
                    } else {
                        toastr.error(data.msg, "错误提示");
                    }
                },
                error: function (data) {
                    toastr.error("操作失败！", "错误提示");
                }
            });
        });
    </script>
</body>

</html>